<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOEFL Academic Discussion Practice</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap');

        body {
            font-family: 'Lato', sans-serif;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .main-container {
            width: 100%;
            max-width: 800px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 30px 40px;
            border: 1px solid #e0e0e0;
        }

        h1 {
            text-align: center;
            color: #005a9c;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 16px;
        }

        .directions {
            background-color: #e6f7ff;
            border-left: 5px solid #1890ff;
            padding: 15px 20px;
            margin-bottom: 25px;
            border-radius: 5px;
            font-size: 15px;
            line-height: 1.6;
        }

        .post {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #d9d9d9;
            background-color: #fafafa;
        }

        .post-author {
            font-weight: 700;
            font-size: 18px;
            color: #003366;
            margin-bottom: 10px;
        }

        .professor .post-author {
            color: #d9534f;
        }

        .post-content {
            font-size: 16px;
            line-height: 1.7;
        }

            .post-content strong {
                color: #005a9c;
            }

        .user-response-area {
            margin-top: 20px;
        }

        .response-header {
            font-size: 20px;
            font-weight: 700;
            color: #005a9c;
            margin-bottom: 15px;
        }

        #user-textarea {
            width: 100%;
            min-height: 180px;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            font-size: 16px;
            font-family: 'Lato', sans-serif;
            resize: vertical;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

            #user-textarea:focus {
                outline: none;
                border-color: #1890ff;
                box-shadow: 0 0 5px rgba(24, 144, 255, 0.2);
            }

            #user-textarea:disabled {
                background-color: #f5f5f5;
                cursor: not-allowed;
            }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .buttons button {
            padding: 10px 20px;
            font-size: 16px;
            font-weight: 700;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
            transition: background-color 0.3s, transform 0.1s;
        }

            .buttons button:active {
                transform: scale(0.98);
            }

        #start-btn {
            background-color: #28a745;
        }

            #start-btn:hover {
                background-color: #218838;
            }

        #submit-btn {
            background-color: #007bff;
        }

            #submit-btn:hover {
                background-color: #0069d9;
            }

            #submit-btn:disabled {
                background-color: #a0a0a0;
                cursor: not-allowed;
            }

        #reset-btn {
            background-color: #dc3545;
        }

            #reset-btn:hover {
                background-color: #c82333;
            }

        .stats {
            display: flex;
            gap: 20px;
            font-size: 18px;
            font-weight: 700;
        }

        #timer {
            color: #005a9c;
        }

        #word-count {
            color: #666;
        }

            #word-count.sufficient {
                color: #28a745;
            }

        #status-message {
            text-align: center;
            margin-top: 15px;
            font-weight: bold;
            height: 20px;
        }
    </style>
</head>
<body>

    <div class="main-container">
        <h1>TOEFL Academic Discussion Practice</h1>
        <p class="subtitle">Simulated Testing Environment</p>

        <div class="directions">
            <strong>Directions:</strong> Read the professor's question and the two student responses. Then write your own response that addresses the professor's question and contributes to the discussion. You must write <strong>at least 100 words</strong>.
        </div>

        <div class="post professor">
            <p class="post-author">Professor Anya Sharma:</p>
            <p class="post-content">
                Hello class. This week, we're discussing the impact of technology on social connections. Some argue that social media and instant messaging have made us more connected than ever, allowing us to maintain relationships across vast distances. Others claim that these technologies lead to more superficial, low-quality interactions and actually increase feelings of loneliness. So, for our discussion this week, I want to ask you: <strong>Does modern technology, especially social media, ultimately bring people closer together or drive them further apart?</strong>
            </p>
        </div>

        <div class="post">
            <p class="post-author">Paul:</p>
            <p class="post-content">
                I definitely believe that modern technology brings people closer. Before, if your best friend moved to another country, you might lose touch completely. Now, you can video chat with them every day and feel like you're in the same room. It also helps people find communities they wouldn't have access to otherwise, like online groups for rare hobbies or support groups for people with specific health conditions. It has opened up a whole new world of social connection that was impossible before.
            </p>
        </div>

        <div class="post">
            <p class="post-author">Sarah:</p>
            <p class="post-content">
                I have to disagree with Paul. While it's true we can "connect" with more people, I think these connections are weak and superficial. People spend hours scrolling through photos and leaving one-word comments instead of having a deep, meaningful conversation. I've seen groups of friends at a restaurant all staring at their phones instead of talking to each other. This isn't real connection; it's a distraction that actually pulls us away from the people who are right in front of us. It creates an illusion of closeness while making us feel more isolated.
            </p>
        </div>

        <div class="user-response-area">
            <p class="response-header">Your Response:</p>
            <textarea id="user-textarea" placeholder="Start writing your response here after clicking 'Start'..." disabled></textarea>
            <div class="controls">
                <div class="stats">
                    <div id="timer">Time: 10:00</div>
                    <div id="word-count">Words: 0</div>
                </div>
                <div class="buttons">
                    <button id="start-btn">Start</button>
                    <button id="submit-btn" disabled>Submit</button>
                    <button id="reset-btn">Reset</button>
                </div>
            </div>
            <p id="status-message"></p>
        </div>
    </div>

    <script>
        const startBtn = document.getElementById('start-btn');
        const submitBtn = document.getElementById('submit-btn');
        const resetBtn = document.getElementById('reset-btn');
        const timerEl = document.getElementById('timer');
        const wordCountEl = document.getElementById('word-count');
        const textarea = document.getElementById('user-textarea');
        const statusMessageEl = document.getElementById('status-message');

        let timer;
        let timeRemaining = 600;

        async function submitResponse() {
            const content = textarea.value;
            const wordCount = content ? content.match(/\S+/g).length : 0;

            if (wordCount === 0) {
                alert("Cannot submit an empty response.");
                return;
            }

            statusMessageEl.textContent = "Submitting...";
            statusMessageEl.style.color = '#007bff';
            submitBtn.disabled = true;

            try {
                // ============ 关键！确保这里的 URL 是你自己的 Render 网址 ============
                const apiUrl = 'https://toefl-final-project.onrender.com/';
                // =====================================================================

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ content: content, wordCount: wordCount }),
                });

                const result = await response.json();

                if (response.ok) {
                    statusMessageEl.textContent = result.message;
                    statusMessageEl.style.color = '#28a745';
                    textarea.disabled = true;
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                statusMessageEl.textContent = `Error: ${error.message}`;
                statusMessageEl.style.color = '#dc3545';
                submitBtn.disabled = false;
            }
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            timerEl.textContent = `Time: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            if (timeRemaining < 60) {
                timerEl.style.color = '#dc3545';
            } else {
                timerEl.style.color = '#005a9c';
            }
        }

        function startTimer() {
            startBtn.disabled = true;
            submitBtn.disabled = false; // <<< 关键修正！已经去掉了注释
            textarea.disabled = false;
            textarea.focus();
            statusMessageEl.textContent = '';

            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    timerEl.textContent = "Time's Up!";
                    textarea.disabled = true;
                    submitBtn.disabled = true;
                    alert("Time's Up! Automatically submitting your response.");
                    submitResponse();
                }
            }, 1000);
        }

        function resetTimer() {
            clearInterval(timer);
            timeRemaining = 600;
            updateTimerDisplay();
            startBtn.disabled = false;
            submitBtn.disabled = true;
            textarea.disabled = true;
            textarea.value = '';
            updateWordCount();
            timerEl.style.color = '#005a9c';
            statusMessageEl.textContent = '';
        }

        function updateWordCount() {
            const text = textarea.value.trim();
            const words = text ? text.match(/\S+/g).length : 0;
            wordCountEl.textContent = `Words: ${words}`;
            if (words >= 100) {
                wordCountEl.classList.add('sufficient');
            } else {
                wordCountEl.classList.remove('sufficient');
            }
        }

        startBtn.addEventListener('click', startTimer);
        submitBtn.addEventListener('click', submitResponse);
        resetBtn.addEventListener('click', resetTimer);
        textarea.addEventListener('input', updateWordCount);

        resetTimer();
    </script>

</body>
</html>